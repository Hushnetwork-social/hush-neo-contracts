# Test: Deploy TokenFactory and verify initial state
# Run with: neoxp batch tests/02-token-factory-deploy.batch --input devnet/devnet.neo-express --reset
#
# --reset resets to genesis before running (repeatable, no prior state needed)
# IMPORTANT: Stop any running neoxp node first: neoxp stop --input devnet/devnet.neo-express
#
# PREREQUISITE: TokenTemplate.nef and TokenFactory.nef must be compiled first:
#   dotnet build src/TokenTemplate
#   dotnet build src/TokenFactory
#
# TokenFactory deploy parameter:
#   [0] owner = deployer address (devnet: NVPBT4gwfokzBXgqHTC68KWWop1M2AWgYY)
#
# NOTE: setNefAndManifest() requires passing binary NEF bytes as a contract argument.
#       This cannot be done from a neoxp batch file because NEF is binary (~2.4 KB).
#       Use the neoxp CLI directly or a PowerShell helper for the initialization step.
#
#   neoxp contract invoke TokenFactory setNefAndManifest \
#       @src/TokenTemplate/bin/sc/TokenTemplate.nef \
#       "$(Get-Content src/TokenTemplate/bin/sc/TokenTemplate.manifest.json -Raw)" \
#       --input devnet/devnet.neo-express -a deployer

# Fund the deployer wallet
transfer 1000 GAS genesis deployer

# Deploy the TokenFactory contract with deployer as owner
contract deploy ../src/TokenFactory/bin/sc/TokenFactory.nef deployer '["NVPBT4gwfokzBXgqHTC68KWWop1M2AWgYY"]'

# Verify post-deployment state (all should be uninitialized defaults)
contract run TokenFactory getOwner -a deployer
contract run TokenFactory getTokenCount -a deployer
contract run TokenFactory getMinFee -a deployer
contract run TokenFactory isInitialized -a deployer
contract run TokenFactory isPaused -a deployer
